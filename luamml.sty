\ProvidesExplPackage {luamml} {2021-04-23} {0.0.1-alpha}
  {Feel free to add a description here}

\int_new:N \l__luamml_flag_int
\tl_new:N \l__luamml_filename_tl
\tl_new:N \l__luamml_root_tl
\tl_set:Nn \l__luamml_root_tl { mrow }
\int_new:N \tracingmathml
\lua_now:n { require'luamml-tex' }

\cs_new:Npn \luamml_flag_process: {
  \int_set:Nn \l__luamml_flag_int { 3 }
}
\cs_new:Npn \luamml_flag_save: {
  \int_set:Nn \l__luamml_flag_int { 1 }
}
\cs_new:Npn \luamml_flag_save:N #1 {
  \int_set:Nn \l__luamml_flag_int { 17 + 32 * #1 }
}
\cs_new:Npn \luamml_flag_save:Nn #1 {
  \int_set:Nn \l__luamml_flag_int { 21 + 32 * #1 }
  \tl_set:Nn \l__luamml_root_tl
}
\cs_new:Npn \luamml_flag_save:n {
  \int_set:Nn \l__luamml_flag_int { 5 }
  \tl_set:Nn \l__luamml_root_tl
}
\cs_new:Npn \luamml_flag_ignore: {
  \int_set:Nn \l__luamml_flag_int { 0 }
}
\cs_new:Npn \luamml_flag_structelem: {
  \int_set:Nn \l__luamml_flag_int { 11 }
}
\cs_new:Npn \luamml_set_filename:n {
  \tl_set:Nn \l__luamml_filename_tl
}
\luamml_flag_process:


\cs_new_protected:Npn \luamml_annotate:nen #1#2#3 {
  \__luamml_annotate_begin:
    #3
    \__luamml_annotate_end:we \tex_numexpr:D #1 \scan_stop: {#2}
}

\cs_new_protected:Npn \luamml_annotate:en #1#2 {
  \__luamml_annotate_begin:
    #2
  \__luamml_annotate_end:e {#1}
}


\cs_new:Npn \__luamml_patch_package:nn #1 #2 {
  \@ifpackageloaded {#1} {#2} {
    \hook_gput_code:nnn {package/after/#1} {luamml} {#2}
  }
}
\cs_new:Npn \__luamml_patch_package:n #1 {
  \__luamml_patch_package:nn {#1} {
    \RequirePackage { luamml-patches-#1 }
  }
}
\RequirePackage { luamml-patches-kernel }
\__luamml_patch_package:n {amsmath}
\__luamml_patch_package:n {array}
